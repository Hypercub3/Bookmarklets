<!DOCTYPE html>
<html>
<head>
<title>Highligher on black text.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="random-color-highlighter-on-black-text---large-palette">Random Color Highlighter on Black Text - Large palette</h1>
<p><a href="javascript:(function()%7Bjavascript%3A(function()%7Bvar%20styleId%3D%22myHighlightTermGlobalStyle%22%3Bif(!document.getElementById(styleId))%7Bvar%20style%3Ddocument.createElement(%22style%22)%3Bstyle.id%3DstyleId%2Cstyle.type%3D%22text%2Fcss%22%2Cstyle.appendChild(document.createTextNode(%22%5Bdata-highlight-term%5D%20%7B%20color%3A%20black%20!important%3B%20%7D%22))%2Cdocument.head.appendChild(style)%7Dvar%20defaultPalette%3D%5B%22%23FFFF99%22%2C%22%2399CCFF%22%2C%22%2399FF99%22%2C%22%23FFCC99%22%2C%22%23FF99CC%22%2C%22%23CC99FF%22%2C%22%2399FFCC%22%2C%22%23FFB3E6%22%2C%22%23FFE6E6%22%2C%22%23E6FFB3%22%2C%22%23B3FFFF%22%2C%22%23E6B3FF%22%2C%22%23FFEBB3%22%2C%22%23B3E6FF%22%5D%3Bfunction%20shuffle(array)%7Bfor(var%20i%3Darray.length-1%3Bi%3E0%3Bi--)%7Bvar%20j%3DMath.floor(Math.random()*(i%2B1))%3B%5Barray%5Bi%5D%2Carray%5Bj%5D%5D%3D%5Barray%5Bj%5D%2Carray%5Bi%5D%5D%7Dreturn%20array%7Dwindow.myHighlightMapping%7C%7C(window.myHighlightMapping%3D%7B%7D)%2Cwindow.myHighlightPalette%7C%7C(window.myHighlightPalette%3DdefaultPalette)%2Cwindow.myHighlightColorCycle%7C%7C(window.myHighlightColorCycle%3Dshuffle(window.myHighlightPalette.slice()))%3Bvar%20selection%3Dwindow.getSelection().toString().trim()%2Cterm%3Dselection%7C%7Cprompt(%22Enter%20text%20to%20highlight%3A%22)%3Bif(term)%7Bfunction%20getNextColor()%7Breturn%200%3D%3D%3Dwindow.myHighlightColorCycle.length%26%26(window.myHighlightColorCycle%3Dshuffle(window.myHighlightPalette.slice()))%2Cwindow.myHighlightColorCycle.shift()%7Dfunction%20escapeRegExp(string)%7Breturn%20string.replace(%2F%5B.*%2B%3F%5E%24%7B%7D()%7C%5B%5C%5D%5C%5C%5D%2Fg%2C%22%5C%5C%24%26%22)%7Dvar%20newColor%3DgetNextColor()%3Bwindow.myHighlightMapping%5Bterm%5D%3DnewColor%2Cfunction(term%2Ccolor)%7Bvar%20safeTerm%3D%22undefined%22!%3Dtypeof%20CSS%26%26CSS.escape%3FCSS.escape(term)%3Aterm.replace(%2F'%2Fg%2C%22%5C%5C'%22)%3Bdocument.querySelectorAll('span%5Bdata-highlight-term%3D%22'%2BsafeTerm%2B'%22%5D').forEach(function(span)%7Bspan.style.backgroundColor%3Dcolor%7D)%7D(term%2CnewColor)%3B!function%20highlightTerm(node%2Cterm%2Ccolor)%7Bif(3%3D%3D%3Dnode.nodeType%26%26!function%20isInsideHighlight(node)%7Bfor(%3Bnode.parentNode%3B)%7Bif((node%3Dnode.parentNode).nodeType%3D%3D%3D1%26%26node.hasAttribute(%22data-highlight-term%22))return!0%7Dreturn!1%7D(node))%7Bvar%20regex%3Dnew%20RegExp(escapeRegExp(term)%2C%22gi%22)%3Bif(regex.test(node.data))%7Bvar%20span%3Ddocument.createElement(%22span%22)%3Bspan.innerHTML%3Dnode.data.replace(regex%2Cfunction(match)%7Breturn'%3Cspan%20data-highlight-term%3D%22'%2Bterm%2B'%22%20style%3D%22background-color%3A'%2Bcolor%2B'%3B%22%3E'%2Bmatch%2B%22%3C%2Fspan%3E%22%7D)%2Cnode.parentNode.replaceChild(span%2Cnode)%7D%7Delse%20if(1%3D%3D%3Dnode.nodeType%26%26!%2F(script%7Cstyle%7Ctextarea%7Cnoscript)%2Fi.test(node.tagName))for(var%20i%3D0%3Bi%3Cnode.childNodes.length%3Bi%2B%2B)highlightTerm(node.childNodes%5Bi%5D%2Cterm%2Ccolor)%7D(document.body%2Cterm%2CnewColor)%7D%7D)()%3B%7D)()%3B">RCH</a></p>
<h2 id="description">Description</h2>
<p>The Text Highlighter bookmarklet enhances webpage readability by highlighting terms with distinct pastel colors. When activated, it either uses your selected text or prompts you to enter a search term. Each unique term gets assigned one of 14 randomly shuffled pastel colors, maintaining consistency across all instances of that term. The text remains black for optimal readability across light and dark modes.</p>
<p>text is made</p>
<h2 id="color-palette">Color Palette</h2>
<p><svg xmlns="http://www.w3.org/2000/svg" viewBox="30 20 920 400"><rect x="30" y="20" width="920" height="400" fill="white"/><text x="50" y="40" font-family="Arial" font-size="24" font-weight="bold">Pastel Color Palette</text><g id="colorGrid"><g transform="translate(50, 60)"><g transform="translate(0, 0)"><rect width="160" height="80" fill="#FFFF99" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pale Yellow</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#FFFF99</text></g><g transform="translate(180, 0)"><rect width="160" height="80" fill="#99CCFF" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Light Sky Blue</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#99CCFF</text></g><g transform="translate(360, 0)"><rect width="160" height="80" fill="#99FF99" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Light Green</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#99FF99</text></g><g transform="translate(540, 0)"><rect width="160" height="80" fill="#FFCC99" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pastel Orange</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#FFCC99</text></g><g transform="translate(720, 0)"><rect width="160" height="80" fill="#FF99CC" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pastel Pink</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#FF99CC</text></g></g><g transform="translate(50, 180)"><g transform="translate(0, 0)"><rect width="160" height="80" fill="#CC99FF" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pastel Lavender</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#CC99FF</text></g><g transform="translate(180, 0)"><rect width="160" height="80" fill="#99FFCC" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pastel Mint</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#99FFCC</text></g><g transform="translate(360, 0)"><rect width="160" height="80" fill="#FFB3E6" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pastel Pinkish</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#FFB3E6</text></g><g transform="translate(540, 0)"><rect width="160" height="80" fill="#FFE6E6" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Softer Pastel Pink</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#FFE6E6</text></g><g transform="translate(720, 0)"><rect width="160" height="80" fill="#E6FFB3" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pastel Greenish</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#E6FFB3</text></g></g><g transform="translate(50, 300)"><g transform="translate(0, 0)"><rect width="160" height="80" fill="#B3FFFF" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pastel Aqua</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#B3FFFF</text></g><g transform="translate(180, 0)"><rect width="160" height="80" fill="#E6B3FF" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Pastel Purple</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#E6B3FF</text></g><g transform="translate(360, 0)"><rect width="160" height="80" fill="#FFEBB3" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Lighter Pastel Orange</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#FFEBB3</text></g><g transform="translate(540, 0)"><rect width="160" height="80" fill="#B3E6FF" rx="4"/><text x="10" y="100" font-family="Arial" font-size="12">Lighter Pastel Blue</text><text x="10" y="115" font-family="Arial" font-size="10" fill="#666666">#B3E6FF</text></g></g></g></svg></p>
<h3 id="flattened-code-for-bookmarklet">Flattened Code (for bookmarklet)</h3>
<pre class="hljs"><code><div>javascript:(function(){var styleId=&quot;myHighlightTermGlobalStyle&quot;;if(!document.getElementById(styleId)){var style=document.createElement(&quot;style&quot;);style.id=styleId,style.type=&quot;text/css&quot;,style.appendChild(document.createTextNode(&quot;[data-highlight-term] { color: black !important; }&quot;)),document.head.appendChild(style)}var defaultPalette=[&quot;#FFFF99&quot;,&quot;#99CCFF&quot;,&quot;#99FF99&quot;,&quot;#FFCC99&quot;,&quot;#FF99CC&quot;,&quot;#CC99FF&quot;,&quot;#99FFCC&quot;,&quot;#FFB3E6&quot;,&quot;#FFE6E6&quot;,&quot;#E6FFB3&quot;,&quot;#B3FFFF&quot;,&quot;#E6B3FF&quot;,&quot;#FFEBB3&quot;,&quot;#B3E6FF&quot;];function shuffle(array){for(var i=array.length-1;i&gt;0;i--){var j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}return array}window.myHighlightMapping||(window.myHighlightMapping={}),window.myHighlightPalette||(window.myHighlightPalette=defaultPalette),window.myHighlightColorCycle||(window.myHighlightColorCycle=shuffle(window.myHighlightPalette.slice()));var selection=window.getSelection().toString().trim(),term=selection||prompt(&quot;Enter text to highlight:&quot;);if(term){function getNextColor(){return 0===window.myHighlightColorCycle.length&amp;&amp;(window.myHighlightColorCycle=shuffle(window.myHighlightPalette.slice())),window.myHighlightColorCycle.shift()}function escapeRegExp(string){return string.replace(/[.*+?^${}()|[\]\\]/g,&quot;\\$&amp;&quot;)}var newColor=getNextColor();window.myHighlightMapping[term]=newColor,function(term,color){var safeTerm=&quot;undefined&quot;!=typeof CSS&amp;&amp;CSS.escape?CSS.escape(term):term.replace(/'/g,&quot;\\'&quot;);document.querySelectorAll('span[data-highlight-term=&quot;'+safeTerm+'&quot;]').forEach(function(span){span.style.backgroundColor=color})}(term,newColor);!function highlightTerm(node,term,color){if(3===node.nodeType&amp;&amp;!function isInsideHighlight(node){for(;node.parentNode;){if((node=node.parentNode).nodeType===1&amp;&amp;node.hasAttribute(&quot;data-highlight-term&quot;))return!0}return!1}(node)){var regex=new RegExp(escapeRegExp(term),&quot;gi&quot;);if(regex.test(node.data)){var span=document.createElement(&quot;span&quot;);span.innerHTML=node.data.replace(regex,function(match){return'&lt;span data-highlight-term=&quot;'+term+'&quot; style=&quot;background-color:'+color+';&quot;&gt;'+match+&quot;&lt;/span&gt;&quot;}),node.parentNode.replaceChild(span,node)}}else if(1===node.nodeType&amp;&amp;!/(script|style|textarea|noscript)/i.test(node.tagName))for(var i=0;i&lt;node.childNodes.length;i++)highlightTerm(node.childNodes[i],term,color)}(document.body,term,newColor)}})();
</div></code></pre>
<hr>
<h3 id="formatted-code">Formatted Code</h3>
<pre class="hljs"><code><div>javascript:(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-comment">// 1) Inject a global CSS rule to force highlighted text to be black (highest precedence)</span>
  <span class="hljs-keyword">var</span> styleId = <span class="hljs-string">'myHighlightTermGlobalStyle'</span>;
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">document</span>.getElementById(styleId)) {
    <span class="hljs-keyword">var</span> style = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'style'</span>);
    style.id = styleId;
    style.type = <span class="hljs-string">'text/css'</span>;
    style.appendChild(<span class="hljs-built_in">document</span>.createTextNode(
      <span class="hljs-string">'[data-highlight-term] { color: black !important; }'</span>
    ));
    <span class="hljs-built_in">document</span>.head.appendChild(style);
  }

  <span class="hljs-comment">// 2) Define a larger palette of distinct pastel colors</span>
  <span class="hljs-keyword">var</span> defaultPalette = [
    <span class="hljs-string">"#FFFF99"</span>, <span class="hljs-comment">// pale yellow</span>
    <span class="hljs-string">"#99CCFF"</span>, <span class="hljs-comment">// light sky blue</span>
    <span class="hljs-string">"#99FF99"</span>, <span class="hljs-comment">// light green</span>
    <span class="hljs-string">"#FFCC99"</span>, <span class="hljs-comment">// pastel orange</span>
    <span class="hljs-string">"#FF99CC"</span>, <span class="hljs-comment">// pastel pink</span>
    <span class="hljs-string">"#CC99FF"</span>, <span class="hljs-comment">// pastel lavender</span>
    <span class="hljs-string">"#99FFCC"</span>, <span class="hljs-comment">// pastel mint</span>
    <span class="hljs-comment">// --- Additional pastels ---</span>
    <span class="hljs-string">"#FFB3E6"</span>, <span class="hljs-comment">// pastel pinkish</span>
    <span class="hljs-string">"#FFE6E6"</span>, <span class="hljs-comment">// softer pastel pink</span>
    <span class="hljs-string">"#E6FFB3"</span>, <span class="hljs-comment">// pastel greenish</span>
    <span class="hljs-string">"#B3FFFF"</span>, <span class="hljs-comment">// pastel aqua</span>
    <span class="hljs-string">"#E6B3FF"</span>, <span class="hljs-comment">// pastel purple</span>
    <span class="hljs-string">"#FFEBB3"</span>, <span class="hljs-comment">// lighter pastel orange</span>
    <span class="hljs-string">"#B3E6FF"</span>  <span class="hljs-comment">// lighter pastel blue</span>
  ];

  <span class="hljs-comment">// Shuffle an array in place (Fisher-Yates)</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shuffle</span>(<span class="hljs-params">array</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = array.length - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i--) {
      <span class="hljs-keyword">var</span> j = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (i + <span class="hljs-number">1</span>));
      [array[i], array[j]] = [array[j], array[i]];
    }
    <span class="hljs-keyword">return</span> array;
  }

  <span class="hljs-comment">// 3) Global objects to store term-color mappings and a shuffled cycle of the palette</span>
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.myHighlightMapping) <span class="hljs-built_in">window</span>.myHighlightMapping = {};
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.myHighlightPalette) <span class="hljs-built_in">window</span>.myHighlightPalette = defaultPalette;
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">window</span>.myHighlightColorCycle) {
    <span class="hljs-built_in">window</span>.myHighlightColorCycle = shuffle(<span class="hljs-built_in">window</span>.myHighlightPalette.slice());
  }

  <span class="hljs-comment">// Function to get the next color from the cycle, reshuffling if exhausted</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNextColor</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.myHighlightColorCycle.length === <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">window</span>.myHighlightColorCycle = shuffle(<span class="hljs-built_in">window</span>.myHighlightPalette.slice());
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.myHighlightColorCycle.shift();
  }

  <span class="hljs-comment">// Helper to safely escape special regex characters</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">escapeRegExp</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/[.*+?^${}()|[\]\\]/g</span>, <span class="hljs-string">"\\$&amp;"</span>);
  }

  <span class="hljs-comment">// 4) Get the term (from selection or prompt)</span>
  <span class="hljs-keyword">var</span> selection = <span class="hljs-built_in">window</span>.getSelection().toString().trim();
  <span class="hljs-keyword">var</span> term = selection || prompt(<span class="hljs-string">"Enter text to highlight:"</span>);
  <span class="hljs-keyword">if</span> (!term) <span class="hljs-keyword">return</span>;

  <span class="hljs-comment">// Always pick a new color for each invocation</span>
  <span class="hljs-keyword">var</span> newColor = getNextColor();
  <span class="hljs-built_in">window</span>.myHighlightMapping[term] = newColor;

  <span class="hljs-comment">// 5) Update existing highlights for this term</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateExistingHighlights</span>(<span class="hljs-params">term, color</span>) </span>{
    <span class="hljs-keyword">var</span> safeTerm = (<span class="hljs-keyword">typeof</span> CSS !== <span class="hljs-string">"undefined"</span> &amp;&amp; CSS.escape)
      ? CSS.escape(term)
      : term.replace(<span class="hljs-regexp">/'/g</span>, <span class="hljs-string">"\\'"</span>);
    <span class="hljs-keyword">var</span> spans = <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'span[data-highlight-term="'</span> + safeTerm + <span class="hljs-string">'"]'</span>);
    spans.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">span</span>) </span>{
      <span class="hljs-comment">// We only set the background color here;</span>
      <span class="hljs-comment">// the global CSS rule forces text to black</span>
      span.style.backgroundColor = color;
    });
  }
  updateExistingHighlights(term, newColor);

  <span class="hljs-comment">// 6) Check if a node is inside an existing highlight</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isInsideHighlight</span>(<span class="hljs-params">node</span>) </span>{
    <span class="hljs-keyword">while</span> (node.parentNode) {
      node = node.parentNode;
      <span class="hljs-keyword">if</span> (node.nodeType === <span class="hljs-number">1</span> &amp;&amp; node.hasAttribute(<span class="hljs-string">"data-highlight-term"</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// 7) Recursively highlight all text-node matches</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlightTerm</span>(<span class="hljs-params">node, term, color</span>) </span>{
    <span class="hljs-keyword">if</span> (node.nodeType === <span class="hljs-number">3</span> &amp;&amp; !isInsideHighlight(node)) {
      <span class="hljs-keyword">var</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(escapeRegExp(term), <span class="hljs-string">"gi"</span>);
      <span class="hljs-keyword">if</span> (regex.test(node.data)) {
        <span class="hljs-keyword">var</span> span = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"span"</span>);
        span.innerHTML = node.data.replace(regex, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">match</span>) </span>{
          <span class="hljs-comment">// Inline style sets the background; text is forced to black by global CSS</span>
          <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;span data-highlight-term="'</span> + term + <span class="hljs-string">'" style="background-color:'</span> + color + <span class="hljs-string">';"&gt;'</span> + match + <span class="hljs-string">'&lt;/span&gt;'</span>;
        });
        node.parentNode.replaceChild(span, node);
      }
    } 
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.nodeType === <span class="hljs-number">1</span> &amp;&amp; !<span class="hljs-regexp">/(script|style|textarea|noscript)/i</span>.test(node.tagName)) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; node.childNodes.length; i++) {
        highlightTerm(node.childNodes[i], term, color);
      }
    }
  }

  <span class="hljs-comment">// 8) Highlight in the document</span>
  highlightTerm(<span class="hljs-built_in">document</span>.body, term, newColor);
})();

</div></code></pre>
<p>To use:</p>
<ol>
<li>Select text on the page and click the bookmarklet to highlight all instances of the selected text</li>
<li>Or click the bookmarklet without a selection to be prompted for a term to highlight</li>
<li>Repeat for different terms - each will get its own distinct color</li>
</ol>

</body>
</html>
